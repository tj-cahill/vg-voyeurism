---
title: "Watching Video Games - Analysis"
author: "Tiernan J. Cahill"
output: html_notebook
---

This script takes the cleaned output from the DATA_MERGE script and runs hypothesis tests and inductive stats for the second part of the analysis, following diagnostics and univariate stats.

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(knitr)
library(ggplot2)
library(ggpubr)
library(car)
readRDS(file = "data/merged_all.rds") -> vgv
readRDS(file = "data/Qualtrics_merged.rds") -> qualtrics
```


# Hypothesis Testing
## Hypothesis 1: PSI -> Enjoyment
H1 is that *viewers with a higher degree of parasocial interaction with the streamer will also experience a higher degree of enjoyment*. This can be assessed through simple bivariate correlation of the self-report measures. (*Note: In this case, we are using Spearman's correlation, because Enjoyment is not normally distributed*).

```{r h1}
# Display a scatter plot
ggplot(qualtrics, aes(x=PSI_Overall, y=IMI_Enjoyment)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("PSI") + ylab("Enjoyment")

cor.test(~ PSI_Overall + IMI_Enjoyment, qualtrics, alternative = "greater", method="spearman") -> h1.test # One-sided test
print(h1.test)
```

The hypothesis is **supported**: *&rho;* = `r h1.test$estimate %>% round(3)`, *p* = `r h1.test$p.value %>% round(3)`. **(Note for future reference: all reports of *p = 0* are actually *p < .001* due to Base R's rounding function.)**

## Hypothesis 2: Facecam -> PSI
H2 is that *viewers in the condition where the facecam was present will experience a higher degree of parasocial interaction than viewers in the condition where the facecam was absent*. This can be assessed with an independent-sample T test.

```{r h2}
# First, we need a version of the full dataset with one row per participant, 
# containing their assigned condition and their self-reported PSI
vgv %>% select(id, stimFace, PSI_Overall) %>% unique() -> h2.data

# Visualize the difference between groups using a boxplot
ggboxplot(h2.data, x = "stimFace", y = "PSI_Overall",
          xlab = "Facecam Present", ylab = "PSI")

# First test for homogeneity of variance
bartlett.test(PSI_Overall ~ stimFace, h2.data) -> h2.bartlett_test
h2.var_equal <- if(h2.bartlett_test$p.value > 0.05) TRUE else FALSE
print(h2.bartlett_test)

t.test(PSI_Overall ~ stimFace, h2.data, var.equal = h2.var_equal, 
       alternative = "less") -> h2.test # One-sided test
print(h2.test)
```

The hypothesis is **supported**: *t*(`r h2.test$parameter`) = `r h2.test$statistic %>% round(3)`, *p* = `r h2.test$p.value %>% round(3)`.

## Hypothesis 3: Streamer Gender -> Perceived Efficacy
H3 is that *the gender of the streamer will affect the perceived efficacy of the streamer*, given identical gameplay performance. This can also be assessed with a Mann-Whitney test (since perceived efficacy is not normally distributed).

```{r h3}
# First, we need a version of the full dataset with one row per participant, 
# containing their assigned condition and their perception of the streamer's
# efficacy
vgv %>% select(id, stimGender, playerEfficacy) %>% unique() -> h3.data

# Visualize the difference between groups using a boxplot
ggboxplot(h3.data, x = "stimGender", y = "playerEfficacy",
          color = "stimGender", legend = "none",
          xlab = "Streamer Gender", ylab = "Perceived Efficacy")
  

wilcox.test(playerEfficacy ~ stimGender, h3.data, 
       alternative = "two.sided") -> h3.test # Two-sided test
print(h3.test)
```

The hypothesis is **not supported**: *W* = `r h3.test$statistic %>% round(3)`, *p* = `r h3.test$p.value %>% round(3)`

### Experience Control
There's a possibility that audience's perception of player skill is moderated by their own experience playing games.

```{r h3b}
# In this case, we want a version of the dataset that includes the previous 
# variables from H3, but with the addition of measures of frequency of play
vgv %>% select(id, stimGender, playerEfficacy, 
               hrsWatchingRecordedVGContent_weekday,
               hrsWatchingRecordedVGContent_weekend,
               hrsWatchingStreamedVGContent_weekday,
               hrsWatchingStreamedVGContent_weekend,
               hrsPlayingSinglePlayer_weekday,
               hrsPlayingSinglePlayer_weekend,
               hrsPlayingMultiPlayer_weekday,
               hrsPlayingMultiPlayer_weekend) %>% unique() -> h3b.data

# Recode non-responses as zero hours
h3b.data[is.na(h3b.data)] = 0

# We can combine some of these measures together--since this level of granularity
# probably isn't particularly helpful--to get aggregate levels of gameplay
# and viewership per week
h3b.data %>% transmute(id = id,
                       stimGender = stimGender,
                       playerEfficacy = playerEfficacy,
                       hrsWatchingVGContent = hrsWatchingRecordedVGContent_weekday * 5 + 
                                              hrsWatchingRecordedVGContent_weekend * 2 +
                                              hrsWatchingStreamedVGContent_weekday * 5 +
                                              hrsWatchingStreamedVGContent_weekend * 2,
                       hrsPlayingGames = hrsPlayingSinglePlayer_weekday * 5 +
                                         hrsPlayingSinglePlayer_weekend * 2 +
                                         hrsPlayingMultiPlayer_weekday * 5 +
                                         hrsPlayingMultiPlayer_weekend * 2) -> h3b.data



# Let's visualize the results
h3b.data %>% ggplot(aes(x=x)) +
  geom_histogram(aes(x = hrsPlayingGames), fill = "#69b3a2", alpha = 0.4, binwidth = 5) +
  geom_label(aes(x = 75, y = 35, label = "Hrs Playing Games"), color = "#69b3a2") +
  geom_histogram(aes(x = hrsWatchingVGContent), fill = "#404080", alpha = 0.4, binwidth = 5) +
  geom_label(aes(x = 75, y = 25, label = "Hrs Watching Games"), color = "#404080")

# Confirm homogeneity of variance by group
leveneTest(playerEfficacy ~ stimGender, h3b.data)

# Remove outliers (defined as those who report spending more than 12 hours per day
# on average eitehr watching or playing games)
h3b.data %>% filter(hrsPlayingGames < 12*7 & hrsWatchingVGContent < 12*7) -> h3b.data

h3b.model <- aov(playerEfficacy ~ hrsPlayingGames + hrsWatchingVGContent + stimGender, h3b.data)

Anova(h3b.model, type = "III")
```
Visualization suggests that most respondents don't play games, but do watch some, and that there are a small number of extreme outliers in terms of both playing and watch (i.e., the figures are right-skewed).

```{r h3b_p2}
# Also check if there's a significant difference between players and non-players,
# watchers and non-watchers
h3b.data %>% mutate(player = hrsPlayingGames > 0,
                    watcher = hrsWatchingVGContent > 0) -> h3b.data

wilcox.test(playerEfficacy ~ player, h3b.data, 
       alternative = "two.sided", correct = FALSE)

wilcox.test(playerEfficacy ~ watcher, h3b.data,
            alternative = "two.sided", correct = FALSE)
```

While the hypothesis is **not supported**, all of this seems to suggest that time spent
watching VG content is more influential in determining perceived efficacy than either
gender or play experience. Taking an exploratory approach, let's dive in further.

```{r h3_exp}
h3_exp.model <- lm(playerEfficacy ~ hrsWatchingVGContent, h3b.data)
summary(h3_exp.model)
# This model has some issues -- come back and respecify
par(mfrow = c(2, 2))
plot(h3_exp.model)

h3b.data %>% ggscatter(x="hrsWatchingVGContent", y = "playerEfficacy", color="stimGender") + stat_smooth(method = "lm")
```
Interestingly, this suggests a small yet significant positive effect of past viewership on the perceived efficacy of the streamer.



## Hypothesis 4: Attention -> Parasocial Interaction
H4 is that *viewers who allocate more attention to the streamer's face (where the facecam is displayed) will experience a proportionately greater level of parasocial interaction*.
```{r h4}
# First, create a version of the dataset with one row per participant, 
# containing their self-reported level of PSI, as well as an aggregate
# measure of their relative attention allocation to the facecam (thus containg
# participants in the facecam condition only )

# vgv %>% 
#   filter(aoi == "FACE") %>%
#   group_by(id) %>%
#   summarise(faceRatioG = mean(perSpentG),
#             faceRatioF = mean(perSpentF),
#             PSI_Overall = first(PSI_Overall)) ->
#   h4.data

# Alternate method of calculating attention allocation
vgv %>%
  filter(stimFace == TRUE) %>%
  group_by(id, aoi) %>%
  summarise(totalG = sum(timeSpentG),
            totalF = sum(timeSpentF),
            PSI_Overall = first(PSI_Overall)) %>%
  ungroup() %>%
  arrange(id, aoi) %>%
  mutate(faceRatioG = totalG / (totalG+lead(totalG)),
         faceRatioF = totalF / (totalF+lead(totalF))) %>%
  filter(aoi == "FACE") %>%
  select(-aoi, -totalG, -totalF) -> h4.data

# Generate a scatter plot for gaze ratio
ggplot(h4.data, aes(x=faceRatioG, y=PSI_Overall)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("Ratio of Gaze on Facecam") + ylab("PSI")

# Generate a scatter plot for fixation ratio
ggplot(h4.data, aes(x=faceRatioF, y=PSI_Overall)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("Ratio of Fixation on Facecam") + ylab("PSI")

# Test the correlation for gaze using Spearman because gaze ratio
# isn't normally distributed)
cor.test(~ PSI_Overall + faceRatioG, h4.data,
         alternative = "greater",
         method="spearman") -> h4.test.g
print(h4.test.g)

# Test the correlation for fixation (
cor.test(~ PSI_Overall + faceRatioF, h4.data,
         alternative = "greater") -> h4.test.f
print(h4.test.f)
```

The hypothesis is **not supported** for gaze measurement: *&rho;* = `r h4.test.g$estimate %>% round(3)`, *p* = `r h4.test.g$p.value %>% round(3)`.

The hypothesis is **not supported** for fixation measurement: *&rho;* = `r h4.test.f$estimate %>% round(3)`, *p* = `r h4.test.f$p.value %>% round(3)`.


## Hypothesis 5: Attention -> Arousal
H5 is that *viewers who allocate more attention to the streamer's face (where the facecam is displayed) will experience a proportionately higher level of emotional arousal*.
```{r h5}
# First, create a version of the dataset with one row per participant, 
# containing aggregate measures of their relative attention allocation to the
# facecam (thus containing participants in the facecam condition only ) and 
# their arousal (GSR)

vgv %>%
  filter(stimFace == TRUE) %>%
  group_by(id, aoi) %>%
  summarise(totalG = sum(timeSpentG),
            totalF = sum(timeSpentF),
            peakCount = sum(peakCount),
            peaksPerMin = mean(peaksPerMin)) %>%
  ungroup() %>%
  arrange(id, aoi) %>%
  mutate(faceRatioG = totalG / (totalG+lead(totalG)),
         faceRatioF = totalF / (totalF+lead(totalF))) %>%
  filter(aoi == "FACE") %>%
  select(-aoi, -totalG, -totalF) -> h5.data

# There are a few outliers in the arousal data, so use the simple 2*IQR rule 
# to filter them out.
h5.data.no_outliers <- h5.data %>% 
  filter(peaksPerMin < median(h5.data$peaksPerMin, na.rm=T) + 2*IQR(h5.data$peaksPerMin, na.rm=T)) %>%
  filter(peaksPerMin > median(h5.data$peaksPerMin, na.rm=T) -
           2*IQR(h5.data$peaksPerMin, na.rm=T))

# Generate a scatter plot for gaze ratio
ggplot(h5.data.no_outliers, aes(x=faceRatioG, y=peaksPerMin)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("Ratio of Gaze on Facecam") + ylab("Arousal")

# Generate a scatter plot for fixation ratio
ggplot(h5.data.no_outliers, aes(x=faceRatioF, y=peaksPerMin)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("Ratio of Fixation on Facecam") + ylab("Arousal")

# Test the correlation for gaze (using Spearman because gaze ratio
# isn't normally distributed)
cor.test(~ peaksPerMin + faceRatioG, h5.data.no_outliers,
         alternative = "greater",
         method="spearman") -> h5.test.g
print(h5.test.g)

# Test the correlation for fixation (using Spearman because GSR data isn't
# normally distributed)
cor.test(~ peaksPerMin + faceRatioF, h5.data.no_outliers,
         alternative = "greater",
         method="spearman") -> h5.test.f
print(h5.test.f)
```
The hypothesis is **not supported** for gaze measurement: *&rho;* = `r h5.test.g$estimate %>% round(3)`, *p* = `r h5.test.g$p.value %>% round(3)`.

The hypothesis is **not supported** for fixation measurement: *&rho;* = `r h5.test.f$estimate %>% round(3)`, *p* = `r h5.test.f$p.value %>% round(3)`.


## Hypothesis 6: Arousal -> Enjoyment
H6 is that *viewers who experience a higher level of emotional arousal will also experience a proportionately higher degree of enjoyment*.

```{r h6}
# First, create a version of the dataset with one row per participant, 
# containing their self-reported level of enjoyment, as well as an aggregate
# measure of their arousal (GSR) across both stimuli
vgv %>% filter(aoi == "GAME") %>%
  group_by(id) %>% 
  summarise(peakCount = sum(peakCount), 
            peaksPerMin = mean(peaksPerMin), 
            IMI_Enjoyment = first(IMI_Enjoyment)) -> 
  h6.data

# There are a few outliers in the biometric data, so use the simple 2*IQR rule 
# to filter them out.
h6.data.no_outliers <- h6.data %>% 
  filter(peaksPerMin < median(h6.data$peaksPerMin, na.rm=T) +
           2*IQR(h6.data$peaksPerMin, na.rm=T)) %>%
  filter(peaksPerMin > median(h6.data$peaksPerMin, na.rm=T) -
           2*IQR(h6.data$peaksPerMin, na.rm=T))

# Generate a scatter plot 
ggplot(h6.data.no_outliers, aes(x=peaksPerMin, y=IMI_Enjoyment)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("Arousal") + ylab("Enjoyment")

# Test the correlation (using Spearman again, since the variables are not
# normally distributed)
cor.test(~ IMI_Enjoyment + peaksPerMin, h6.data.no_outliers, 
         alternative = "greater",
         method="spearman") -> h6.test
print(h6.test)
```

The hypothesis is **not supported**: *&rho;* = `r h6.test$estimate %>% round(3)`, *p* = `r h6.test$p.value %>% round(3)`.