---
title: "Watching Video Games - Analysis"
author: "Tiernan J. Cahill"
output: html_notebook
---

This script takes the cleaned output from the DATA_MERGE script and runs hypothesis tests and inductive stats for the second part of the analysis, following diagnostics and univariate states.

```{r setup, include=FALSE}
library(dplyr)
library(knitr)
library(ggplot2)
library(ggpubr)
readRDS(file = "data/merged_all.rds") -> vgv
readRDS(file = "data/Qualtrics_merged.rds") -> qualtrics
```


# Hypothesis Testing
## Hypothesis 1: PSI -> Enjoyment
H1 is that *viewers with a higher degree of parasocial interaction with the streamer will also experience a higher degree of enjoyment*. This can be assessed through simple bivariate correlation of the self-report measures. (*Note: In this case, we are using Spearman's correlation, because Enjoyment is not normally distributed*).

```{r h1}
# Display a scatter plot
ggplot(qualtrics, aes(x=PSI_Overall, y=IMI_Enjoyment)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("PSI") + ylab("Enjoyment")

cor.test(~ PSI_Overall + IMI_Enjoyment, qualtrics, alternative = "greater", method="spearman") -> h1.test # One-sided test
print(h1.test)
```

The hypothesis is **supported**: *&rho;* = `r h1.test$estimate %>% round(3)`, *p* = `r h1.test$p.value %>% round(3)`. **(Note for future reference: all reports of *p = 0* are actually *p < .001* due to Base R's rounding function.)**

## Hypothesis 2: Facecam -> PSI
H2 is that *viewers in the condition where the facecam was present will experience a higher degree of parasocial interaction than viewers in the condition where the facecam was absent*. This can be assessed with an independent-sample T test.

```{r h2}
# First, we need a version of the full dataset with one row per participant, 
# containing their assigned condition and their self-reported PSI
vgv %>% select(id, stimFace, PSI_Overall) %>% unique() -> h2.data

# Visualize the difference between groups using a boxplot
ggboxplot(h2.data, x = "stimFace", y = "PSI_Overall",
          xlab = "Facecam Present", ylab = "PSI")

# First test for homogeneity of variance
bartlett.test(PSI_Overall ~ stimFace, h2.data) -> h2.bartlett_test
h2.var_equal <- if(h2.bartlett_test$p.value > 0.05) TRUE else FALSE
print(h2.bartlett_test)

t.test(PSI_Overall ~ stimFace, h2.data, var.equal = h2.var_equal, 
       alternative = "less") -> h2.test # One-sided test
print(h2.test)
```

The hypothesis is **supported**: *t*(`r h2.test$parameter`) = `r h2.test$statistic %>% round(3)`, *p* = `r h2.test$p.value %>% round(3)`.

## Hypothesis 3: Streamer Gender -> Perceived Efficacy
H3 is that *the gender of the streamer will affect the perceived efficacy of the streamer*, given identical gameplay performance. This can also be assessed with a Mann-Whitney test (since perceived efficacy is not normally distributed).

```{r h3}
# First, we need a version of the full dataset with one row per participant, 
# containing their assigned condition and their perception of the streamer's
# efficacy
vgv %>% select(id, stimGender, playerEfficacy) %>% unique() -> h3.data

# Visualize the difference between groups using a boxplot
ggboxplot(h3.data, x = "stimGender", y = "playerEfficacy",
          color = "stimGender", legend = "none",
          xlab = "Streamer Gender", ylab = "Perceived Efficacy")
  

wilcox.test(playerEfficacy ~ stimGender, h3.data, 
       alternative = "two.sided") -> h3.test # Two-sided test
print(h3.test)
```

The hypothesis is **not supported**: *W* = `r h3.test$statistic %>% round(3)`, *p* = `r h3.test$p.value %>% round(3)`

## Hypothesis 4: Attention -> Parasocial Interaction
H4 is that *viewers who allocate more attention to the streamer's face (where the facecam is displayed) will experience a proportionately greater level of parasocial interaction*.
```{r h4}
# First, create a version of the dataset with one row per participant, 
# containing their self-reported level of PSI, as well as an aggregate
# measure of their relative attention allocation to the facecam (thus containg
# participants in the facecam condition only )

vgv %>% 
  filter(aoi == "FACE") %>%
  group_by(id) %>%
  summarise(camRatioG = mean(perSpentG),
            camRatioF = mean(perSpentF),
            PSI_Overall = first(PSI_Overall)) ->
  h4.data

# Generate a scatter plot for gaze ratio
ggplot(h4.data, aes(x=camRatioG, y=PSI_Overall)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("% of Gaze on Facecam") + ylab("PSI")

# Generate a scatter plot for fixation ratio
ggplot(h4.data, aes(x=camRatioF, y=PSI_Overall)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("% of Fixation on Facecam") + ylab("PSI")

# Test the correlation for gaze
cor.test(~ PSI_Overall + camRatioG, h4.data, 
         alternative = "greater") -> h4.test.g
print(h4.test.g)

# Test the correlation for fixation (using Spearman because fixation ratio
# isn't normally distributed)
cor.test(~ PSI_Overall + camRatioF, h4.data, 
         alternative = "greater",
         method="spearman") -> h4.test.f
print(h4.test.f)
```

## Hypothesis 5: Attention -> Arousal
H5 is that *viewers who allocate more attention to the streamer's face (where the facecam is displayed) will experience a proportionately higher level of emotional arousal*.

## Hypothesis 6: Arousal -> Enjoyment
H6 is that *viewers who experience a higher level of emotional arousal will also experience a proportionately higher degree of enjoyment*.

```{r h6}
# First, create a version of the dataset with one row per participant, 
# containing their self-reported level of enjoyment, as well as an aggregate
# measure of their arousal (GSR) across both stimuli
vgv %>% filter(aoi == "GAME") %>%
  group_by(id) %>% 
  summarise(peakCount = sum(peakCount), 
            peaksPerMin = mean(peaksPerMin), 
            IMI_Enjoyment = first(IMI_Enjoyment)) -> 
  h6.data

# There are a few outliers in the biometric data, so use the simple 2*IQR rule 
# to filter them out.
h6.data.no_outliers <- h6.data %>% 
  filter(peaksPerMin < median(h6.data$peaksPerMin, na.rm=T) + 2*IQR(h6.data$peaksPerMin, na.rm=T))

# Generate a scatter plot 
ggplot(h6.data.no_outliers, aes(x=peaksPerMin, y=IMI_Enjoyment)) + geom_point() +
  geom_smooth(method = lm) +
  xlab("Arousal") + ylab("Enjoyment")

# Test the correlation (using Spearman again, since the variables are not
# normally distributed)
cor.test(~ IMI_Enjoyment + peaksPerMin, h6.data.no_outliers, 
         alternative = "greater",
         method="spearman") -> h6.test
print(h6.test)
```

The hypothesis is **not supported**: *&rho;* = `r h6.test$estimate %>% round(3)`, *p* = `r h6.test$p.value %>% round(3)`.